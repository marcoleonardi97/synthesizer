
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/cosmo/plot_test_age_lookup.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_cosmo_plot_test_age_lookup.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_cosmo_plot_test_age_lookup.py:


Age lookup test
===============

Test using a lookup grid for particle ages (calculated
from the scsale factor representation native to most
cosmological snapshot outputs), and compare to the direct
astropy calculation. Show dependence of relative error
on lookup grid resolution.

.. GENERATED FROM PYTHON SOURCE LINES 11-47



.. image-sg:: /auto_examples/cosmo/images/sphx_glr_plot_test_age_lookup_001.png
   :alt: plot test age lookup
   :srcset: /auto_examples/cosmo/images/sphx_glr_plot_test_age_lookup_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/hostedtoolcache/Python/3.10.15/x64/lib/python3.10/site-packages/astropy/cosmology/flrw/base.py:1072: IntegrationWarning: The integral is probably divergent, or slowly convergent.
      return quad(self._lookback_time_integrand_scalar, z, inf)[0]






|

.. code-block:: Python


    import h5py
    import matplotlib.pyplot as plt
    import numpy as np
    from astropy.cosmology import Planck15

    from synthesizer.load_data.utils import age_lookup_table, lookup_age

    # get scale factors from test file
    with h5py.File("../../tests/data/camels_snap.hdf5", "r") as hf:
        form_time = hf["PartType4/GFM_StellarFormationTime"][:]

    # Calculate ages of these explicitly using astropy
    part_ages_proper = Planck15.age(1.0 / form_time - 1)

    fig, ax = plt.subplots(1, 1)

    # Loop over different look up grid resolutions
    for delta_a in [1e-2, 1e-3, 1e-4, 1e-5, 5e-6]:
        # create the lookup grid
        scale_factors, ages = age_lookup_table(Planck15, delta_a=delta_a)

        # Look up the ages for the particles
        part_ages = lookup_age(form_time, scale_factors, ages)

        ax.scatter(
            part_ages_proper,
            np.log10(np.abs((part_ages - part_ages_proper).value)),
            s=1,
            alpha=1,
            label=delta_a,
        )

    ax.legend(title=r"$\Delta a$:")
    ax.set_ylabel(r"$\Delta \mathrm{log_{10} \, age \;\; (Gyr)}$")
    plt.show()


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 44.977 seconds)


.. _sphx_glr_download_auto_examples_cosmo_plot_test_age_lookup.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_test_age_lookup.ipynb <plot_test_age_lookup.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_test_age_lookup.py <plot_test_age_lookup.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_test_age_lookup.zip <plot_test_age_lookup.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
